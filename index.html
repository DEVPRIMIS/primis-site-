<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Primis App</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <!-- Auth Section -->
  <section id="auth">
    <h2>Connexion</h2>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Mot de passe"><br>
    <button id="loginBtn">Se connecter</button>
    <button id="registerBtn">Cr√©er un compte</button>
  </section>

  <!-- Main Section -->
  <section id="main" class="hidden">
    <h2>Bienvenue <span id="userEmail"></span></h2>
    <button id="logoutBtn">D√©connexion</button>
    <h3>Publier un message</h3>
    <textarea id="message" placeholder="√âcris quelque chose..."></textarea><br>
    <button id="postBtn">Publier</button>
    <h3>Fil d'actualit√©</h3>
    <ul id="feed"></ul>
  </section>

  <!-- Firebase App -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

    // üî• Remplace ici avec TES donn√©es Firebase :
    const firebaseConfig = {
      apiKey: "COLLE_TA_VRAIE_CLE_ICI",
      authDomain: "primis-39910.firebaseapp.com",
      projectId: "primis-39910",
      storageBucket: "primis-39910.appspot.com",
      messagingSenderId: "TON_ID",
      appId: "TON_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM
    const loginBtn = document.getElementById("loginBtn");
    const registerBtn = document.getElementById("registerBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const userEmailSpan = document.getElementById("userEmail");
    const mainSection = document.getElementById("main");
    const authSection = document.getElementById("auth");
    const postBtn = document.getElementById("postBtn");
    const messageInput = document.getElementById("message");
    const feed = document.getElementById("feed");

    registerBtn.onclick = () => {
      createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value)
        .then(() => alert("Compte cr√©√©"))
        .catch(e => alert(e.message));
    };

    loginBtn.onclick = () => {
      signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value)
        .catch(e => alert(e.message));
    };

    logoutBtn.onclick = () => signOut(auth);

    postBtn.onclick = async () => {
      const message = messageInput.value.trim();
      if (message) {
        await addDoc(collection(db, "posts"), {
          user: auth.currentUser.email,
          text: message,
          timestamp: new Date()
        });
        messageInput.value = "";
      }
    };

    onAuthStateChanged(auth, user => {
      if (user) {
        authSection.classList.add("hidden");
        mainSection.classList.remove("hidden");
        userEmailSpan.textContent = user.email;
      } else {
        authSection.classList.remove("hidden");
        mainSection.classList.add("hidden");
      }
    });

    onSnapshot(query(collection(db, "posts"), orderBy("timestamp", "desc")), snapshot => {
      feed.innerHTML = "";
      snapshot.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = `${doc.data().user}: ${doc.data().text}`;
        feed.appendChild(li);
      });
    });
  </script>
</body>
  </html>
